{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport * as echarts from 'echarts/lib/echarts';\nimport './WordCloudSeries';\nimport './WordCloudView';\nimport wordCloudLayoutHelper from './layout';\n\nif (!wordCloudLayoutHelper.isSupported) {\n  throw new Error('Sorry your browser not support wordCloud');\n} // https://github.com/timdream/wordcloud2.js/blob/c236bee60436e048949f9becc4f0f67bd832dc5c/index.js#L233\n\n\nfunction updateCanvasMask(maskCanvas) {\n  var ctx = maskCanvas.getContext('2d');\n  var imageData = ctx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n  var newImageData = ctx.createImageData(imageData);\n  var toneSum = 0;\n  var toneCnt = 0;\n\n  for (var i = 0; i < imageData.data.length; i += 4) {\n    var alpha = imageData.data[i + 3];\n\n    if (alpha > 128) {\n      var tone = imageData.data[i] + imageData.data[i + 1] + imageData.data[i + 2];\n      toneSum += tone;\n      ++toneCnt;\n    }\n  }\n\n  var threshold = toneSum / toneCnt;\n\n  for (var i = 0; i < imageData.data.length; i += 4) {\n    var tone = imageData.data[i] + imageData.data[i + 1] + imageData.data[i + 2];\n    var alpha = imageData.data[i + 3];\n\n    if (alpha < 128 || tone > threshold) {\n      // Area not to draw\n      newImageData.data[i] = 0;\n      newImageData.data[i + 1] = 0;\n      newImageData.data[i + 2] = 0;\n      newImageData.data[i + 3] = 0;\n    } else {\n      // Area to draw\n      // The color must be same with backgroundColor\n      newImageData.data[i] = 255;\n      newImageData.data[i + 1] = 255;\n      newImageData.data[i + 2] = 255;\n      newImageData.data[i + 3] = 255;\n    }\n  }\n\n  ctx.putImageData(newImageData, 0, 0);\n}\n\necharts.registerLayout(function (ecModel, api) {\n  ecModel.eachSeriesByType('wordCloud', function (seriesModel) {\n    var gridRect = echarts.helper.getLayoutRect(seriesModel.getBoxLayoutParams(), {\n      width: api.getWidth(),\n      height: api.getHeight()\n    });\n    var data = seriesModel.getData();\n    var canvas = document.createElement('canvas');\n    canvas.width = gridRect.width;\n    canvas.height = gridRect.height;\n    var ctx = canvas.getContext('2d');\n    var maskImage = seriesModel.get('maskImage');\n\n    if (maskImage) {\n      try {\n        ctx.drawImage(maskImage, 0, 0, canvas.width, canvas.height);\n        updateCanvasMask(canvas);\n      } catch (e) {\n        console.error('Invalid mask image');\n        console.error(e.toString());\n      }\n    }\n\n    var sizeRange = seriesModel.get('sizeRange');\n    var rotationRange = seriesModel.get('rotationRange');\n    var valueExtent = data.getDataExtent('value');\n    var DEGREE_TO_RAD = Math.PI / 180;\n    var gridSize = seriesModel.get('gridSize');\n    wordCloudLayoutHelper(canvas, {\n      list: data.mapArray('value', function (value, idx) {\n        var itemModel = data.getItemModel(idx);\n        return [data.getName(idx), itemModel.get('textStyle.fontSize', true) || echarts.number.linearMap(value, valueExtent, sizeRange), idx];\n      }).sort(function (a, b) {\n        // Sort from large to small in case there is no more room for more words\n        return b[1] - a[1];\n      }),\n      fontFamily: seriesModel.get('textStyle.fontFamily') || seriesModel.get('emphasis.textStyle.fontFamily') || ecModel.get('textStyle.fontFamily'),\n      fontWeight: seriesModel.get('textStyle.fontWeight') || seriesModel.get('emphasis.textStyle.fontWeight') || ecModel.get('textStyle.fontWeight'),\n      gridSize: gridSize,\n      ellipticity: gridRect.height / gridRect.width,\n      minRotation: rotationRange[0] * DEGREE_TO_RAD,\n      maxRotation: rotationRange[1] * DEGREE_TO_RAD,\n      clearCanvas: !maskImage,\n      rotateRatio: 1,\n      rotationStep: seriesModel.get('rotationStep') * DEGREE_TO_RAD,\n      drawOutOfBound: seriesModel.get('drawOutOfBound'),\n      layoutAnimation: seriesModel.get('layoutAnimation'),\n      shuffle: false,\n      shape: seriesModel.get('shape')\n    });\n\n    function onWordCloudDrawn(e) {\n      var item = e.detail.item;\n\n      if (e.detail.drawn && seriesModel.layoutInstance.ondraw) {\n        e.detail.drawn.gx += gridRect.x / gridSize;\n        e.detail.drawn.gy += gridRect.y / gridSize;\n        seriesModel.layoutInstance.ondraw(item[0], item[1], item[2], e.detail.drawn);\n      }\n    }\n\n    canvas.addEventListener('wordclouddrawn', onWordCloudDrawn);\n\n    if (seriesModel.layoutInstance) {\n      // Dispose previous\n      seriesModel.layoutInstance.dispose();\n    }\n\n    seriesModel.layoutInstance = {\n      ondraw: null,\n      dispose: function dispose() {\n        canvas.removeEventListener('wordclouddrawn', onWordCloudDrawn); // Abort\n\n        canvas.addEventListener('wordclouddrawn', function (e) {\n          // Prevent default to cancle the event and stop the loop\n          e.preventDefault();\n        });\n      }\n    };\n  });\n});\necharts.registerPreprocessor(function (option) {\n  var series = (option || {}).series;\n  !echarts.util.isArray(series) && (series = series ? [series] : []);\n  var compats = ['shadowColor', 'shadowBlur', 'shadowOffsetX', 'shadowOffsetY'];\n  echarts.util.each(series, function (seriesItem) {\n    if (seriesItem && seriesItem.type === 'wordCloud') {\n      var textStyle = seriesItem.textStyle || {};\n      compatTextStyle(textStyle.normal);\n      compatTextStyle(textStyle.emphasis);\n    }\n  });\n\n  function compatTextStyle(textStyle) {\n    textStyle && echarts.util.each(compats, function (key) {\n      if (textStyle.hasOwnProperty(key)) {\n        textStyle['text' + echarts.format.capitalFirst(key)] = textStyle[key];\n      }\n    });\n  }\n});","map":{"version":3,"sources":["C:/Users/Administrator/Desktop/data_view/my_project/vue2_app/myapp/node_modules/_echarts-wordcloud@2.0.0@echarts-wordcloud/src/wordCloud.js"],"names":["echarts","wordCloudLayoutHelper","isSupported","Error","updateCanvasMask","maskCanvas","ctx","getContext","imageData","getImageData","width","height","newImageData","createImageData","toneSum","toneCnt","i","data","length","alpha","tone","threshold","putImageData","registerLayout","ecModel","api","eachSeriesByType","seriesModel","gridRect","helper","getLayoutRect","getBoxLayoutParams","getWidth","getHeight","getData","canvas","document","createElement","maskImage","get","drawImage","e","console","error","toString","sizeRange","rotationRange","valueExtent","getDataExtent","DEGREE_TO_RAD","Math","PI","gridSize","list","mapArray","value","idx","itemModel","getItemModel","getName","number","linearMap","sort","a","b","fontFamily","fontWeight","ellipticity","minRotation","maxRotation","clearCanvas","rotateRatio","rotationStep","drawOutOfBound","layoutAnimation","shuffle","shape","onWordCloudDrawn","item","detail","drawn","layoutInstance","ondraw","gx","x","gy","y","addEventListener","dispose","removeEventListener","preventDefault","registerPreprocessor","option","series","util","isArray","compats","each","seriesItem","type","textStyle","compatTextStyle","normal","emphasis","key","hasOwnProperty","format","capitalFirst"],"mappings":"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","sourcesContent":["import * as echarts from 'echarts/lib/echarts';\n\nimport './WordCloudSeries';\nimport './WordCloudView';\n\nimport wordCloudLayoutHelper from './layout';\n\nif (!wordCloudLayoutHelper.isSupported) {\n    throw new Error('Sorry your browser not support wordCloud');\n}\n\n// https://github.com/timdream/wordcloud2.js/blob/c236bee60436e048949f9becc4f0f67bd832dc5c/index.js#L233\nfunction updateCanvasMask(maskCanvas) {\n    var ctx = maskCanvas.getContext('2d');\n    var imageData = ctx.getImageData(\n        0, 0, maskCanvas.width, maskCanvas.height);\n    var newImageData = ctx.createImageData(imageData);\n\n    var toneSum = 0;\n    var toneCnt = 0;\n    for (var i = 0; i < imageData.data.length; i += 4) {\n        var alpha = imageData.data[i + 3];\n        if (alpha > 128) {\n            var tone = imageData.data[i]\n                + imageData.data[i + 1]\n                + imageData.data[i + 2];\n            toneSum += tone;\n            ++toneCnt;\n        }\n    }\n    var threshold = toneSum / toneCnt;\n\n    for (var i = 0; i < imageData.data.length; i += 4) {\n        var tone = imageData.data[i]\n            + imageData.data[i + 1]\n            + imageData.data[i + 2];\n        var alpha = imageData.data[i + 3];\n\n        if (alpha < 128 || tone > threshold) {\n            // Area not to draw\n            newImageData.data[i] = 0;\n            newImageData.data[i + 1] = 0;\n            newImageData.data[i + 2] = 0;\n            newImageData.data[i + 3] = 0;\n        }\n        else {\n            // Area to draw\n            // The color must be same with backgroundColor\n            newImageData.data[i] = 255;\n            newImageData.data[i + 1] = 255;\n            newImageData.data[i + 2] = 255;\n            newImageData.data[i + 3] = 255;\n        }\n    }\n\n    ctx.putImageData(newImageData, 0, 0);\n}\n\necharts.registerLayout(function (ecModel, api) {\n    ecModel.eachSeriesByType('wordCloud', function (seriesModel) {\n        var gridRect = echarts.helper.getLayoutRect(\n            seriesModel.getBoxLayoutParams(), {\n                width: api.getWidth(),\n                height: api.getHeight()\n            }\n        );\n        var data = seriesModel.getData();\n\n        var canvas = document.createElement('canvas');\n        canvas.width = gridRect.width;\n        canvas.height = gridRect.height;\n\n        var ctx = canvas.getContext('2d');\n        var maskImage = seriesModel.get('maskImage');\n        if (maskImage) {\n            try {\n                ctx.drawImage(maskImage, 0, 0, canvas.width, canvas.height);\n                updateCanvasMask(canvas);\n            }\n            catch (e) {\n                console.error('Invalid mask image');\n                console.error(e.toString());\n            }\n        }\n\n        var sizeRange = seriesModel.get('sizeRange');\n        var rotationRange = seriesModel.get('rotationRange');\n        var valueExtent = data.getDataExtent('value');\n\n        var DEGREE_TO_RAD = Math.PI / 180;\n        var gridSize = seriesModel.get('gridSize');\n        wordCloudLayoutHelper(canvas, {\n            list: data.mapArray('value', function (value, idx) {\n                var itemModel = data.getItemModel(idx);\n                return [\n                    data.getName(idx),\n                    itemModel.get('textStyle.fontSize', true)\n                        || echarts.number.linearMap(value, valueExtent, sizeRange),\n                    idx\n                ];\n            }).sort(function (a, b) {\n                // Sort from large to small in case there is no more room for more words\n                return b[1] - a[1];\n            }),\n            fontFamily: seriesModel.get('textStyle.fontFamily')\n                || seriesModel.get('emphasis.textStyle.fontFamily')\n                || ecModel.get('textStyle.fontFamily'),\n            fontWeight: seriesModel.get('textStyle.fontWeight')\n                || seriesModel.get('emphasis.textStyle.fontWeight')\n                || ecModel.get('textStyle.fontWeight'),\n\n            gridSize: gridSize,\n\n            ellipticity: gridRect.height / gridRect.width,\n\n            minRotation: rotationRange[0] * DEGREE_TO_RAD,\n            maxRotation: rotationRange[1] * DEGREE_TO_RAD,\n\n            clearCanvas: !maskImage,\n\n            rotateRatio: 1,\n\n            rotationStep: seriesModel.get('rotationStep') * DEGREE_TO_RAD,\n\n            drawOutOfBound: seriesModel.get('drawOutOfBound'),\n\n            layoutAnimation: seriesModel.get('layoutAnimation'),\n\n            shuffle: false,\n\n            shape: seriesModel.get('shape')\n        });\n\n        function onWordCloudDrawn(e) {\n            var item = e.detail.item;\n            if (e.detail.drawn && seriesModel.layoutInstance.ondraw) {\n                e.detail.drawn.gx += gridRect.x / gridSize;\n                e.detail.drawn.gy += gridRect.y / gridSize;\n                seriesModel.layoutInstance.ondraw(\n                    item[0], item[1], item[2], e.detail.drawn\n                );\n            }\n        }\n\n        canvas.addEventListener('wordclouddrawn', onWordCloudDrawn);\n\n        if (seriesModel.layoutInstance) {\n            // Dispose previous\n            seriesModel.layoutInstance.dispose();\n        }\n\n        seriesModel.layoutInstance = {\n            ondraw: null,\n\n            dispose: function () {\n                canvas.removeEventListener('wordclouddrawn', onWordCloudDrawn);\n                // Abort\n                canvas.addEventListener('wordclouddrawn', function (e) {\n                    // Prevent default to cancle the event and stop the loop\n                    e.preventDefault();\n                });\n            }\n        };\n    });\n});\n\necharts.registerPreprocessor(function (option) {\n    var series = (option || {}).series;\n    !echarts.util.isArray(series) && (series = series ? [series] : []);\n\n    var compats = ['shadowColor', 'shadowBlur', 'shadowOffsetX', 'shadowOffsetY'];\n\n    echarts.util.each(series, function (seriesItem) {\n        if (seriesItem && seriesItem.type === 'wordCloud') {\n            var textStyle = seriesItem.textStyle || {};\n\n            compatTextStyle(textStyle.normal);\n            compatTextStyle(textStyle.emphasis);\n        }\n    });\n\n    function compatTextStyle(textStyle) {\n        textStyle && echarts.util.each(compats, function (key) {\n            if (textStyle.hasOwnProperty(key)) {\n                textStyle['text' + echarts.format.capitalFirst(key)] = textStyle[key];\n            }\n        });\n    }\n});\n"]},"metadata":{},"sourceType":"module"}